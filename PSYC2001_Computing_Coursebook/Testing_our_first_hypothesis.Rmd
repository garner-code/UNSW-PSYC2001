# Testing our first hypothesis

Today we are going to ask our first question and seek an answer from the data. We will get the data into shape so that it is in the right format for visualizing and analysing. Then we will run the analysis and learn the answer to our question. Welcome. You are now a psychologist :)


## Checking installation and loading packages

As usual we first always check and load in our required packages. Amend the code in
your script so that it matches the code below. Then make sure it runs just fine.

```{r message = FALSE, warning= FALSE}
# Check if packages are installed, if not install.
if(!require(here)) install.packages('here') #checks if a package is installed and installs it if required.
if(!require(tidyverse)) install.packages('tidyverse')

library(here) #loads in the specified package
library(tidyverse)
```


## Developing our hypotheses

Today we are going to address one of the key questions of the study about social media use – how does mood influence active social media use? Active social media use involves interacting with content (i.e. liking posts) rather than just observing posts.

There is some evidence to suggest that passive social media use is associated with lower mood in adolescents, whereas active social media use is related to positive mood [Dienlin & Johannes, 2020](https://pmc.ncbi.nlm.nih.gov/articles/PMC7366938/). However, a lot of the existing evidence comes from self-report, rather than measuring social media behaviour directly.

To address this question, the researchers used the participants' metadata to count how frequently they liked posts. By cross-referencing this with the mood diary kept by each participant, they were able to calculate the average number of likes per 10 minutes of use when participants were in a good mood, and when they were in a bad mood.

It should be clear by now that we will be addressing this question using the `good_mood_likes` and `bad_mood_likes` varaibles.  Remember, these variables stand for the following:

-   `good_mood_likes` – average number of likes made over 10 min during a good mood (from platform + diary)
-   `bad_mood_likes` – as above, but during bad mood

But you should know this, because you read the README.txt file already, right? :)


### Activity - Defining our hypotheses

Based on the information above, discuss and formulate hypotheses around the following:

1. Should there be a difference in the number of likes between the mood conditions
2. What direction do you think this difference could be? Can you formulate an experimental hypothesis each way – i.e. good mood likes > bad mood likes, and vice versa?
3. What is the null hypothesis?

::: {style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;"}
<strong>Question:</strong> Discuss this with your neighbour and your tutor. Make sure you have clearly defined your hypotheses before moving forward.
:::

## Visualising our data

We may have mentioned before that it's incredibly important to visualize your data before running any statistical tests. This is because visualizing your data can help you understand the underlying distribution of the data, identify any potential outliers or anomalies, and ensure that the assumptions of the statistical test you plan to use are met. Remember, it protects against "garbage in, garbage out"!

### Activity - Loading in the data

Last lab we were very smart and saved the cleaned version of the data as a new CSV file. This is what we will be using today. We put it in the Data folder for you already. Use the Files pane to check.

First step! Let's load the dataset `PSYC2001_social-media-data-cleaned.csv`.  To do this we use the same `read.csv()` function combined with `here()`. Do you remember how to do this?

Complete the following line of code in your script. Again, we have been cheeky and have left a little bit out. But you should be able to work it out. You can also refer back to Section \@ref(sec-import-data) if you need to.

```{r, eval=FALSE }
social_media <- read.csv(file = here(,"PSYC2001_social-media-data-cleaned.csv")) #reads in CSV files
```

```{r, message=FALSE, echo=FALSE, results='hide'}

social_media <- read.csv(file = here("Data","PSYC2001_social-media-data-cleaned.csv"))
```

Now, we did save the data ourselves last week, so we know it is clean. But just to be sure, amend your script so you can get a summary of the data using the `summary()` function. If you don't remember how to do this, then you can check what happened in Section \@ref(sec-data-view).

Before we conduct any kind of statistical test it is a good idea to see how it looks. This will give us an understanding about the underlying data that is driving the results of our statistical test. 

::: {style="border-left: 4px solid #FF9800; background-color: #FFF3E0; padding: 10px; margin: 10px 0;"}
<strong>Warning:</strong> It is generally **bad practice** to go straight from the raw data to the results of a statistical test without first visualising the data.
:::


```{r, echo=FALSE, out.width="50%", fig.align='center', fig.cap="Professors reaction when you don't visualise data"}
knitr::include_graphics("images/Testing_our_first_hypothesis/Statistics_professors_reaction.gif")
```


## Density plots are useful (and pretty)

We can look at the distribution of the data using a density plot. A density plot is a smoothed version of a histogram which allows us to understand what the full distribution might look like if we had all the data in the world. More information on that [is here](https://www.data-to-viz.com/graph/density.html) if you are interested !

In order to make this easy to plot we first have to wrangle our data a bit. Remember, data analysis is 90% wrangling, 10% analysis! What we want to do here is convert our data from a wide-format (which is more digestible for us mere humans) into a long format (which programs like R generally like more!). You can read more on that [here](https://www.statology.org/long-vs-wide-data/), but to make it simple, we just need to get the key variables from our data that currently look like this:

**Wideform data**
```{r, wide, echo=FALSE}

head(social_media %>% select(id, good_mood_likes, bad_mood_likes))

```

And convert it into a long format that looks like this:

```{r, long, echo=FALSE}

head(social_media %>% select(id, good_mood_likes, bad_mood_likes) %>%
  pivot_longer(cols = ends_with("likes"), names_to = "mood", values_to = "likes"))
```

As you can see, instead of having each subject's good and bad mood likes in separate columns, we now have a single column for likes and a second column which indicates whether the likes were made in a good or bad mood. So each subject now has two rows in the dataset. This makes it much easier to plot, and to do many other things!

### Activity - Get back on the pipes!

Its time to get back on the pipes!
The below code gets our data into longform by taking the following steps:  

- First we use the `select()` function to easily choose which columns we do (or don't) want to keep in our dataframe. 
- Second we use the `pivot_longer()` function which allows us to combine different columns together. Both of these functions come from the `tidyverse` package. 
- In the code below we take the columns ending with "likes" and put their values (i.e the number of likes) into the column "likes" and their column names names (i.e good or bad mood) into the column "mood". 

Highlight and run this code in your script to get the data into longform.

```{r Pivoting_data}

social_media_likes <- social_media %>% 
  select("id","good_mood_likes","bad_mood_likes") %>% # choose which columns we want keep in our dataframe
  pivot_longer(cols = ends_with("likes"), names_to = "mood", values_to = "likes") #take columns ending with "likes" and move the column names into "mood" and column values into "likes"

```

Note that we have saved this changed data as a new object called `social_media_likes`.

Let's make sure that this data still looks okay by using the `head()` function. Complete the code in your script so that it looks exactly like below

```{r View_of_the_data}
head(social_media_likes)
```


Et voila!

### Activity - start plotting

Now, we can get a density plot in R by using the `geom_density` function inside `ggplot()`.


```{r Create a density plot, message = FALSE}

social_media_likes %>% 
ggplot(aes(x = likes, colour = mood)) +
  geom_density(linewidth = 2) +
    labs(x = "Number of likes", y = "Density") +
  theme_classic() #themes can be provided to ggplot which give it a bunch of aesthetics to change. One of these is theme_classic
```

::: {style="border-left: 4px solid #2196F3; background-color: #E7F3FE; padding: 10px; margin: 10px 0;"}
<strong>Info:</strong> We are using a new function here called `theme_classic()`. This makes the graph look at a bit nicer. There are a bunch of other available themes [here](https://ggplot2.tidyverse.org/reference/ggtheme.html). We also have a new argument `colour` inside the `aes()` function which tells `ggplot()` to use different line colours depending on the participants mood (i.e good or bad mood).
:::


## Activity 2 - Choosing a new theme

Lets have a go at replicating the previous graph but using a new theme. You can pick whichever theme you think looks the best. Notice that changing the theme will only change non-data related aesthetic features of the graph.


```{r Activity 2 - Changing ggplot themes, message = FALSE}

social_media_likes %>% 
ggplot(aes(x = likes, colour = mood)) +
  geom_density(linewidth = 2) +
    labs(x = "Number of likes", y = "Density") +
  theme_bw() #themes can be provided to ggplot which give it a bunch of aesthetics to change. One of these is theme_classic
```

## Descriptive statistics

Before we can move onto conducting t-tests it is always a good idea to generate our descriptive statistics. For the data we are looking at **the most relevant descriptive statistics are the mean and standard deviation**. This is because we want to conduct a t-test to compare the average likes in different moods. We can easily get this information in R by using the  `summarise()` function together with the `group_by()` function. The `group_by()` splits the data into different groups and the `summarise()` function calculates a statistic (i.e the mean and standard deviation). Both of these packages come from the `tidyverse` package.

```{r}
social_media_descriptives <- social_media_likes %>% 
  group_by(mood) %>% #split the data by mood
  summarise(mean_likes = mean(likes),
            sd_likes = sd(likes)) #calculate the mean number of likes

head(social_media_descriptives)
```

::: {style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;"}
<strong>Question:</strong> What are the mean number of likes in each different mood ? What is the standard deviation ?
:::

## Activity 3 - Calculating the median number of likes

Great ! We have the mean number of likes when subjects are in a good and bad mood. Please see if you are able to use these functions to instead calculate the median number of likes under different mood conditions. 

<div style="border-left: 4px solid #00bfa5; background-color: #e0f2f1; padding: 10px; margin: 10px 0;">
  <strong>Hint:</strong> The `median()` function is used to calculate medians ! </div>

```{r}
social_media_median <- social_media_likes %>% 
  group_by(mood) %>% #split the data by mood
  summarise(median_likes = median(likes)) #calculate the mean number of likes

head(social_media_median)

```

## Testing hypotheses manually

Now that we have had a look at the structure and descriptives statistics of our data we can have a go at using a t-test to compare the number of likes participants made in a good and bad mood. We could of course do this manually, by hand (as we have in the statistics tutorials). We have shown this below using the first 10 values for good and bad mood likes. 

```{r, echo=FALSE, out.width="75%", fig.align='center', fig.cap="t-test table"}
knitr::include_graphics("https://github.com/BsoCool/UNSW-PSYC2001/blob/main/All%20images%20for%20computing%20tutorials/Testing_our_first_hypothesis/Manual%20t-test%20table.JPG?raw=true")
```

Thankfully, we have long since past the stone (pen) age so it is no longer necessary to do this by hand. We can get computers to do this for us! 

```{r, echo=FALSE, out.width="50%", fig.align='center', fig.cap="Handwritten statistiscs be like"}
knitr::include_graphics("https://github.com/BsoCool/UNSW-PSYC2001/blob/main/All%20images%20for%20computing%20tutorials/Testing_our_first_hypothesis/Space%20odyssey.gif?raw=true
")
```

## Testing hypothesis using a two-sample t-test

We can very easily calculate a t-test in R using the `t.test()` function which comes as part of `baseR`. Please first have a look at this function using the `?` syntax to understand its arguments. We recommend using the console from now on to do this rather than creating a codeblock. 

```{r, echo=FALSE, out.width="100%", fig.align='center', fig.cap="Finding the Console"}
knitr::include_graphics("https://github.com/BsoCool/UNSW-PSYC2001/blob/main/All%20images%20for%20computing%20tutorials/Testing_our_first_hypothesis/Navigating%20to%20the%20Console.gif?raw=true")
```

We can see that `t.test()` takes different arguments which are important for the way it handles the data. What values you provide to these arguments is dependent on what kind of test you want to conduct. One of the most important arguments to fill in is the `paired` argument. This determines whether you are conducting an independent or paired samples t-test. Here, we have collected the number of likes for the same subject in different moods. This means this data comes from a repeated-measures design, and so a paired t-test is most appropriate. We also need to provide `t.test()` with a formula telling it what to do with our data. The left hand side is the numerical variable and the right hand side is a grouping variable.


```{r conducting our t-test}
#t.test(formula = likes ~ mood, data = social_media_likes, paired = TRUE)  #compute a t-test. Likes ~ mood indicates that likes is the numerical variable and mood is a grouping variables. Paired indicates whether to conduct a paired or independent t-test.
```

::: {style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;"}
<strong>Question:</strong> Discuss the output of this paired t-test with your neighbour and tutors. What does it tell us ?
:::

## Activity 4 - One-sample t-tests

Now that we have the output of a paired t-test we can compare it to a one sample t-test. The results of both of these tests should be identical (this has been covered in the lectures). For those that haven't watched the lectures, this is because a paired t-test is basically a one-sample t-test of matched difference scores ([more on that here](https://statisticsbyjim.com/hypothesis-testing/t-tests-1-sample-2-sample-paired-t-tests/))

Are you able to conduct a one-sample t-test using R ? 

First you will need to use the `mutate()` function on the original `social_media` dataframe to create a difference column.
```{r Activity 3 - First create a new column}
social_media_diff <- social_media %>% 
  mutate(likes_diff = good_mood_likes - bad_mood_likes) #first try to create a new column which is the difference between mood likes

head(social_media_diff)
```

Once we have correctly calculated our difference score we can use the `t.test()` function to get our results. 

```{r Activity 3 - Now conduct a one-sample t-test}

t.test(formula = likes_diff~1, data = social_media_diff) #the formula likes_diff~1 indicates that there is no grouping variables (i.e just compare to 0!)
```

::: {style="border-left: 4px solid #2196F3; background-color: #E7F3FE; padding: 10px; margin: 10px 0;"}
<strong>Info:</strong> The right hand side of the formula 'likes_diff~**1**' indicates that there is no grouping variable.
:::

::: {style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;"}
<strong>Question:</strong> Compare the output of the one-sample t-test and the paired t-test. Are they the same ?
:::

## Writing up results and conclusions

Let's have a go at writing up the results of the paired samples t-test we have conducted in APA format. While it is not necessarily critical to use APA formatting outside of these psychology courses, it is important to follow some existing format so that readers can easily interpret your results and conclusions about important data.

::: {style="border-left: 4px solid #8B5E3C; background-color: #F5F5DC; padding: 10px; margin: 10px 0;"}
<strong>Results:</strong> A paired samples t-test indicated that the number of likes was greater when participants were in a bad mood (M = 49.8 , SD = 17.2) than in a good mood (M = 43.0 , SD = 16.1) and this difference was statistically significant (t(59) = 3.336, p = 0.001).
:::

What can we conclude from this? Please have a go at writing this up. 

::: {style="border-left: 4px solid #8B5E3C; background-color: #F5F5DC; padding: 10px; margin: 10px 0;"}
<strong>Conclusions:</strong> Your conclusion will go here !
:::


## Plotting our results

Now that we have conducted our statistical test we need to present the results in the simplest way possible. One way to do this is by using the average number of likes when participants are in a good and bad mood and plotting it using a column graph.


## Activity 5 - Plotting the mean number of likes

Are you able to plot the mean number of likes as a column graph ?

::: {style="border-left: 4px solid #00bfa5; background-color: #e0f2f1; padding: 10px; margin: 10px 0;"}
<strong>Hint:</strong> This will be very similar to the code used to plot the density graph but instead using `geom_col()`.
:::


```{r Activity 5}

social_media_descriptives %>%   #write code that produces a column graph of likes with a different colour for each mood
ggplot(aes(y = mean_likes, x = mood, fill = mood)) +
  geom_col(linewidth = 2) +
    labs(y = "Number of likes", x = "Mood")+
  theme_classic()

```

## You are Free!

Well done you have finished for this week! There is no extension activity this week so if you have finished please confirm that you understand everything with your tutor.

```{r, echo=FALSE, out.width="50%", fig.align='center', fig.cap="Students leaving evil statistics classes"}
knitr::include_graphics("https://github.com/BsoCool/UNSW-PSYC2001/blob/main/All%20images%20for%20computing%20tutorials/Testing_our_first_hypothesis/Students%20leaving.gif?raw=true")
```



