---
title: "Tutorial 6 - Exploring statistical relationships"
output: html_document
---

### **Quick links**
1. [Power Analyses](#power_analyses)
2. [Visualising and Conducting Correlations](#correlations)
3. [Linear Regressions](#linear_regression)

### **Checking installation and loading packages**

As usual we first always check and load in our required packages.

```{r checking and loading in packages, message = FALSE, warning= FALSE}
# Check if packages are installed, if not install.
if(!require(here)) install.packages('here') #checks if a package is installed and installs it if required.
if(!require(tidyverse)) install.packages('tidyverse')
if(!require(ggplot2)) install.packages('ggplot2')

library(here) #loads in the specified package
library(tidyverse)
library(ggplot2)
```

---

### **Activity 1 - Installing and loading a new package**

We are going to be using a new package called `pwrss`. This will allow us to complete power calculations. 

Can you figure out how to check if this package is already installed on your computer and get it up and loaded ? 

```{r message = FALSE, warning= FALSE}
if(!require(pwrss)) install.packages("pwrss")

library(pwrss)
```

Well done ! If you aren't able to figure this out please ask your tutor as you will need this package installed to complete todays computing activities. 

---

### **Investigating correlational relationships**

This week, we are going to explore relationships between continuous variables, using correlation and regression.

We have previously looked at how mood and location influence social media use. Now we’re going to look at the relationship between social media use, age and political activism. It has previously been shown that social media use has a positive relationship with levels of political activism in other countries such as Jordan (Alodat et al, 2023). However, we don’t know if this is true for young adults in Australia. This is what we will test today.

---

### **Activity 2 - Formulate your research question**

Before we being we first need to load in our dataset for today. Are you able to load in the `PSYC2001_social-media-data.csv` dataset ? 

```{r Activity 2}
social_media <- read.csv(file = here("Data","PSYC2001_social-media-data.csv")) #reads in CSV files
```


Will young adults who spend a lot of time on social media be more policitally active ? Or the opposite? Or neither ? 

<div style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;">
  <strong>Question:</strong> What is a reasonable null and alternate hypothesis? The class will come up with a hypothesis. </div>

---
  
### **Power analysis on correlations** {#power_analyses}

Now that we have generated our hypothesis, **it would be good practice to conduct a power analysis to determine the sample size required to detect our effect of interest.**

When conducting a power analysis for correlations (as should be clear from your lectures and tutorials on power analysis) there are a few important ingredients. 

The first is **desired power**. Lets say we want 90% power to detect our effect.
The second is the **alpha level**. This is conventionally set to 0.05. 

The final is the **correlation coefficient 'r'**. 

<div style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;">
  <strong>Question:</strong> What do you think the correlation coefficient 'r' will be for our class hypothesis? </div>
  
Now that we have these parameters we can perform a power calculation using the `pwrss.z.corr` function. 
  
```{r}
pwrss.z.corr(r = 0.60, r0 = 0,
             power = 0.90, alpha = 0.05, 
             alternative = "not equal")
```

<div style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;">
  <strong>Question:</strong> What is the takeaway from this output ? Do we have a sufficient sample size to detect our effect of interest ?  </div>


  <div style="border-left: 4px solid #2196F3; background-color: #E7F3FE; padding: 10px; margin: 10px 0;">
  <strong>Info:</strong> We can also use this package to do power calculations for other tests like t-tests and regressions.</div>

---
  
### **Activity 3 - Conducting a power analysis for a t-test**

We can also use the power analysis functions from the `pwrss` package to perform power analyses for other types of statistical tests. For instance, 
we can conduct a power analysis for an independent samples t-test using the function `pwrss.t.2means`. 

Lets assume that we want to find a mean difference between groups on a reaction time measure of at least 25 milliseconds. Additionally, lets say that from previous experiments we know that the standard deviation of reaction times is approximately 25 milliseconds. We might want, say 90% power to detect this effect.

The below is an example of how this could be input to determine sample size. 


```{r}
pwrss.t.2means(mu1 = 0, mu2 = 25, sd1 = 50, power = 0.90, alpha = 0.05 ) #set mu1 =0 so that mu2 can be the mean difference value. sd1 is the standard deviation. 
```

```{r, echo=FALSE, out.width="50%", fig.align='center', fig.cap="Figure 1: The power of power analyses"}
knitr::include_graphics("https://github.com/BsoCool/UNSW-PSYC2001/blob/main/Tutorial%206%20-%20Exploring%20statistical%20relationships/Figure%201%20-%20The%20power%20of%20power%20analyses.jpg?raw=true")
```

---

### **Activity 4 - How much political attitude?**

Let's now get an idea of our much political attitude these participants have. We have scores from 3 subscales of a political-attitudes questionnaire. We need to combine them into a single ‘attitude’ score for each participant. Each subscale score carries a different weighting towards the total ‘attitude’ score.

<div style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;">
  <strong>Question:</strong> Why would each subscale carry a different weighting? </div>
  
The formula for calculating attitude is:

$$Attitude = 0.25 \times informed + 0.35 \times campaign + 0.4 \times activism$$

Using this formula are you able to figure out how to create the attitude variables ? 

<div style="border-left: 4px solid #00bfa5; background-color: #e0f2f1; padding: 10px; margin: 10px 0;">
  <strong>Hint:</strong> Use the mutate function ! </div>

```{r Activity 4}
social_media_attitutde <- social_media %>% 
  mutate(attitude = 0.25*polit_informed +
                    0.35*polit_campaign +
                    0.4*polit_activism)

```

---

### **Activity 5 - looking for straight lines** {#correlations}

Now lets visualise this in R. 

We’re going to explore our data to see if it is suitable for a regression analysis. Remember, we use a regression analysis when we think a straight line is a good enough description of the relationship between our variables.

```{r, echo=FALSE, out.width="50%", fig.align='center', fig.cap="Figure 2: MFW people don't visualise their data"}
knitr::include_graphics("https://github.com/BsoCool/UNSW-PSYC2001/blob/main/Tutorial%206%20-%20Exploring%20statistical%20relationships/Figure%202%20-%20No%20visualisation%20is%20bad.jpg?raw=true")
```



Let's use `ggplot` to  make scatter plots to show the relationships between age, time_on_social and attitude. You should wind up with 3 scatterplots.


<div style="border-left: 4px solid #00bfa5; background-color: #e0f2f1; padding: 10px; margin: 10px 0;">
  <strong>Hint:</strong> Remember that you need to change `-999` values to `NA` before you can plot!  </div>
  
```{r Replace -999 with NA}

social_media_attitutde_NA <- social_media_attitutde %>%
  mutate(time_on_social = na_if(time_on_social,-999)) #mutate alters columns and rows.
                                                      #na_if replaces -999 with NA.


```

```{r Scatterplot of age and time_on_social, warning=FALSE}
social_media_attitutde_NA %>% 
  ggplot(aes(y = age, x = time_on_social)) +
  geom_point(colour = "orange") +
  labs(x = "Age", y = "Time on social") +
  theme_classic() 
```

```{r Scatterplot of age and attitude, warning=FALSE}
social_media_attitutde_NA %>% 
  ggplot(aes(y = age, x = attitude)) +
  geom_point(colour = "blue") +
  labs(x = "Age", y = "Attitude") +
  theme_classic() 
```

```{r social_media_attitutde_NA of time_on_social and attitude, warning=FALSE}
social_media_attitutde_NA %>% 
  ggplot(aes(y = time_on_social, x = attitude)) +
  geom_point(colour = "red") +
  labs(x = "Time on social", y = "Attitude") +
  theme_classic() 
```


<div style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;">
  <strong>Question:</strong> Do the relationships look linear or non-linear? Which correlation analyses would you be more cautious about running? </div>

---
  
### **Conducting correlations**

Let’s find out if there is a correlation between ‘time_on_social’ and ‘attitude’. To do this we can use the `cor.test()` function. This function takes in two arguments, one for each variable (column). 

```{r Correlations between time_on_social and attitude}
cor.test(x = social_media_attitutde_NA$time_on_social, y = social_media_attitutde_NA$attitude, use = "complete.obs") #use = "complete.obs" removes all NA values from the correlation. 
```

<div style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;">
  <strong>Question:</strong> Have a look at the output in the console. What is the relationship between ‘time_on_social’ and ‘attitude’? Can you reject the null hypothesis? Was your hypothesis supported? What does the ‘df’ value tell you about the sample size? Why is it that number? </div>

---
  
### **Activity 6 - Exploring the data**

Now we can harness the power of R to perform multiple correlations all at the same time ahhhhhhhhhh !

<div style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;">
  <strong>Question:</strong> First what other relationships do you think could exist between variables in this dataset ? Make two hypotheses and discuss them with your tutor. </div>

Create a scatterplot of the variables you have hypothesised using the code blocks below:

```{r Scatterplot 1, eval = FALSE}
social_media_attitutde_NA %>% 
  ggplot() +
  geom_point() +
  labs() +...
```

```{r Scatterplot 2, eval = FALSE}
social_media_attitutde_NA %>% 
  ggplot() +
  geom_point() +
  labs() +...
```

Now compute correlations between these your chosen variables. 

```{r Correlation 1, eval = FALSE}
cor.test(x = , y =  use = "complete.obs")

```

```{r Correlation 2, eval = FALSE}
cor.test(x = , y =  use = "complete.obs")

```

---

### **Linear regression in R ** {#linear_regression}

The power of Jamovi doesn’t stop at mass correlations. We can also run a regression analysis. Instead of looking for a statistical relationship between x and y, in regression we are asking if we can predict what y will be, under circumstances we are stuck on a desert island, and we only have access to x.

We can fit a linear regression model using the `lm()` function in R. Please make sure to have a look at this function using the `?` syntax before moving on. To fit our linear regression model we have to specify a formula, similar to how we did in tutorial 4. Here the left side in the formula is the dependent variable whereas the right side is the independent/predictor variable. 

```{r}
model<-lm(formula = time_on_social ~ attitude, data = social_media_attitutde_NA ) #since time_on_social is on the left side it is being predicted by attitude 
```

<div style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;">
  <strong>Question:</strong> Use the jamovi output to complete the following regression equation:
attitude’ = a + beta*time_on_social </div>


But think for a second... where is our R^2^ value and our p value ? 

<div style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;">
  <strong>Question:</strong> Can we make interpretations about the linear regression without these ?  </div>

We can get the R^2^ and p value by generating a summary of our linear regression model. To do this we simply use the `summary()` function. 

```{r}
summary(model)
```

<div style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;">
  <strong>Question:</strong> What does this output mean ? What does the R^2^ mean ? How does the R compare to the results of your correlation analysis? Why is this?  </div>
  
Well done guys you have survived another computing tutorial. We promise you are almost at the end !


```{r, echo=FALSE, out.width="50%", fig.align='center', fig.cap="Figure 3: It almost over (I promise)"}
knitr::include_graphics("https://github.com/BsoCool/UNSW-PSYC2001/blob/main/Tutorial%206%20-%20Exploring%20statistical%20relationships/Figure%203%20-%20Statistical%20trauma.gif?raw=true")
```




