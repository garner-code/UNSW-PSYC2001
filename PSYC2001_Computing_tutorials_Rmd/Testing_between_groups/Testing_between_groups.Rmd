---
title: "Testing between groups"
output: 
  html_document:
    theme: readable

---
## Checking installation and loading packages

As usual we first always check and load in our required packages.

```{r  message = FALSE, warning= FALSE}
# Check if packages are installed, if not install.
if(!require(here)) install.packages('here') #checks if a package is installed and installs it if required.
if(!require(tidyverse)) install.packages('tidyverse')
if(!require(ggplot2)) install.packages('ggplot2')

library(here) #loads in the specified package
library(tidyverse)
library(ggplot2)
```

## Testing between groups

We observed last week how mood impacts active social media behaviour. However, that is not the only factor that influences social media use. For example, [Sapienza et al (2023)](https://academic.oup.com/pnasnexus/article/2/11/pgad357/7442564) found that people in rural areas are more likely to use their smartphone for social media and gaming, whereas urban dwellers are more likely to use their phone for navigation and business.

However, we do not know if people living in urban and rural areas engage with social media differently, regardless of how long they spend on their chosen platforms. Today we will address this question using the `urban`, `good_mood_likes`, `bad_mood_likes`, and `followers` variables. Remember, these variables stand for the following:

-   `urban` – urban (1) or rural (2) area (based on postcode density)
-   `good_mood_likes` – average number of likes made over 10 min during a good mood (from platform + diary)
-   `bad_mood_likes` – as above, but during bad mood
-   `followers` – average number of followers across platforms


## Activity 1 - Formulate your research question

What do you think? Will urban and rural dwellers engage differently with social media? Will there be a difference in the number of likes made by people living in urban vs rural areas? Or in the number of followers people have in urban vs rural areas?

::: {style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;"}
<strong>Question:</strong> What are the null hypotheses for your research questions (you should have one for ‘likes’ and one for ‘followers’? What would you expect to see if your prediction is correct? Discuss this with your neighbor and your tutor.
:::

::: {style="border-left: 4px solid #00bfa5; background-color: #e0f2f1; padding: 10px; margin: 10px 0;"}
<strong>Hint:</strong> We are going to average over the effect of mood, so we do not need to include mood in our predictions about likes.
:::

## Activity 2 - Creating our likes variable

Today we will be averaging across mood to get the number of likes for urban and rural dwellers. This means we first need to create a new variable called `likes` which is the average of the likes in a good and bad mood.

We first load in our`PSYC2001_social-media-data.csv` dataset.

```{r }
social_media <- read.csv(file = here("Data","PSYC2001_social-media-data-cleaned.csv")) #reads in CSV files
```

Lets double check its the data we think it is...

```{r check data}

head(social_media, 10) # you can even say how many lines you want to see! Try changing the number, and see what happens.
```

Are you able to fill the code below using the `mutate()` function to create this new 'likes' variable? 

::: {style="border-left: 4px solid #00bfa5; background-color: #e0f2f1; padding: 10px; margin: 10px 0;"}
<strong>Hint:</strong> The average of likes is `(good_mood_likes + bad_mood_likes)/2`
:::

```{r }

social_media_likes <- social_media %>% 
  mutate(likes =(bad_mood_likes + good_mood_likes)/2 ) %>% #create a new column with specified values
  select(id, urban, likes, followers) #keep specified columns in dataframe

head(social_media_likes)

```


## Wrangling our data

Now that we have this object it is important to check the format of the data. Lets use the `str()` function that we learned about in the [second tutorial](#importing-your-data-in-r) to do this.

```{r}
str(social_media_likes) #provides a summary of the data structure.
```

First we can see that having the values in `urban` are coded as either 1 (urban) or 2 (rural). Lets change this so that instead of using numbers we use the actual descriptions of urban and rural. It is surprisingly difficult to remember what 1 and 2 stand for once you come to look at your graphs. Life will be much easier if we can see what 1 and 2 stand for instead. To do this we will use the `mutate()` function with the `case_when()` function which replaces (or creates) specific values in a variable with new ones.

```{r}
social_media_likes <- social_media_likes %>% 
  mutate(urban = case_when(urban == 1 ~ "urban", 
                           urban == 2 ~ "rural")) #case_when uses if_else logic to replace values with specified values if the cases match.

str(social_media_likes)

```

We can see that `urban` is now classed as a `chr` (character) but we will eventually need to split our graphs by `urban`. This means that `urban` should be a factor instead. (Also, urban is a factor in the experiment, so lets keep it consistent). Luckily, we can change this easily by using `as.factor()` within the `mutate()` function. The `as.factor()` function is used to convert other datatypes to factors !

```{r}
social_media_likes <- social_media_likes %>% 
  mutate(urban = as.factor(urban))

str(social_media_likes)
```

The data is now in a format that we should be able to easily visualise it and conduct our statistical tests. Well done !

```{r, echo=FALSE, out.width="50%", fig.align='center', fig.cap="What it feels like teaching this section"}
knitr::include_graphics("https://github.com/BsoCool/UNSW-PSYC2001/blob/main/All%20images%20for%20computing%20tutorials/Testing_between_groups/What%20it%20feels%20like%20to%20explain%20this%20section.gif?raw=true")
```


## Activity 3 - Visualising our data before analysis 

We’re now going to look at the data in 2 ways. First, we’re going to look at how the data is distributed across all participants, so that we can check if the data meets our assumptions about normality. Second, we are going to plot our dependent variables (`likes`, `followers`) by group, to gain a visual understanding for what group differences might look like, if they exist.

Here, we create a density plot for `likes`. 

```{r Density plot of likes}
social_media_likes %>% 
  ggplot(aes(x = likes)) +
  geom_density(linewidth = 2, colour = "blue") + #the argument linewidth is used to alter the size of the density line. 
  labs(x = "Number of Likes", y = "Density") +
  theme_classic() 
```

::: {style="border-left: 4px solid #2196F3; background-color: #E7F3FE; padding: 10px; margin: 10px 0;"}
<strong>Info:</strong> We use a new argument here `linewidth` to control the size of the density line.
:::


Now, can you make a density plot for `followers`? Go on, you are a coder and you are strong.

```{r Density plot of followers}

social_media_likes %>% 
  ggplot(aes(x = followers)) + 
  geom_density(linewidth = 2, colour = "orange") +
  labs(x = "Number of followers", y = "Density") +
  theme_classic() 

```

::: {style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;"}
<strong>Question:</strong> Do `likes` and `followers` look normally distributed to you? Why might the data be shaped how they are for each variable?
:::

::: {style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;"}
<strong>Question:</strong> What impact does your new understanding of the data have on your analysis, if any?
:::

## Activity 4 - Visualising group differences

Now we are going to make some density plots and boxplots, split by the urban factor so that we can see the group differences.

Are you able to help with this?

::: {style="border-left: 4px solid #00bfa5; background-color: #e0f2f1; padding: 10px; margin: 10px 0;"}
<strong>Hint:</strong> Use the `colour` argument in `aes()` to split the plot by `Urban`
:::

```{r Density plot likes split by urban}
social_media_likes %>% 
  ggplot(aes(x = likes, colour = urban)) +
  geom_density(linewidth = 2) +
  labs(x = "Number of Likes", y = "Density") +
  scale_colour_manual(values = c(rural = "purple", urban = "green")) + #manually define colours of specific parts of a graph
  theme_classic() 
```

```{r Density plot followers split by urban}
social_media_likes %>% 
  ggplot(aes(x = followers, colour = urban)) +
  geom_density(linewidth = 2) +
  labs(x = "Number of Followers", y = "Density") +
  scale_colour_manual(values = c(rural = "purple", urban = "green")) + #manually define colours of specific parts of a graph
  theme_classic() 
```

::: {style="border-left: 4px solid #2196F3; background-color: #E7F3FE; padding: 10px; margin: 10px 0;"}
<strong>Info:</strong> We are using a new function here called `scale_colour_manual()`. This allows you manually define the colours of specific parts of a graph. Here we have used it to define colours for specific groups.
:::

This is not the only way we may want to view the group differences in likes and followers. Using a grouped boxplot can be a handy way at looking at how groups differ from each other.

```{r Boxplot of likes split by urban}
social_media_likes %>% 
  ggplot(aes(y = likes, colour = urban, x = urban)) +
  geom_boxplot() +
  labs(x = " ", y = "Number of Likes") +
  scale_colour_manual(values = c(rural = "purple", urban = "green")) + #manually define colours of specific parts of a graph
  theme_classic() 

```

Can you change the code below so that the x-axis has a label, and the y-axis label is correct?

```{r Boxplot of followers split by urban}
social_media_likes %>% 
  ggplot(aes(y = followers, colour = urban, x = urban)) +
  geom_boxplot() +
  labs(x = "", y = "Number of Likes") +
  scale_colour_manual(values = c(rural = "purple", urban = "green")) + #manually define colours of specific parts of a graph
  theme_classic() 

```

::: {style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;"}
<strong>Question:</strong> What do you think the data suggest about the group differences for `likes` and `followers`? Was it in-line with your predictions from activity 1? Are there any caveats or reasons to be cautious about your interpretations?
:::

## Activity 5 - Descriptive statistics

It is important to generate descriptive statistics before our t-test. Are you able to fill in the code below to generate the mean and standard deviation of likes and followers for urban and rural dwellers ? 

```{r}
social_media_descriptives <- social_media_likes %>% 
  group_by(urban) %>% 
  summarise(
    mean_followers = mean(followers),
    mean_likes = mean(likes),
    sd_follower = sd(followers),
    sd_likes = sd(likes)
  )

head(social_media_descriptives)
```

## Independent samples t-test

We now want to learn whether we have evidence for differences between urban and rural dwellers on the 'likes' and 'followers' variables.

## Activity 6 - Undertaking an independent samples t-test

Can you work out how to perform an independent samples t-test for these variables ?

::: {style="border-left: 4px solid #00bfa5; background-color: #e0f2f1; padding: 10px; margin: 10px 0;"}
<strong>Hint:</strong> Use the `t.test()` function from the tutorial last week and pay attention to the 'paired' argument !
:::

```{r}
t.test(formula = likes ~ urban, data = social_media_likes, var.equal = TRUE, paired = FALSE)
```

```{r}
t.test(formula = followers ~ urban, data = social_media_likes, var.equal = TRUE, paired = FALSE)
```

::: {style="border-left: 4px solid #9C27B0; background-color: #F3E5F5; padding: 10px; margin: 10px 0;"}
<strong>Question:</strong> Discuss the output of this independent t-tests, what does it tell you about the differences between urban and rural dwellers and how they use social media ? Is it what you expected when you formulated your hypotheses?
:::

```{r, echo=FALSE, out.width="50%", fig.align='center', fig.cap="Exams are hard"}
knitr::include_graphics("https://github.com/BsoCool/UNSW-PSYC2001/blob/main/All%20images%20for%20computing%20tutorials/Testing_between_groups/Exams%20are%20hard.jpg?raw=true")
```


## Writing up results and conclusions

Lets have a go at writing up the results and conclusions for this independent samples t-test.

::: {style="border-left: 4px solid #8B5E3C; background-color: #F5F5DC; padding: 10px; margin: 10px 0;"}
<strong>Results:</strong> An independent samples t-test indicated that the number of likes was greater for rural (M = 52.1 , SD = 12.7) compared to urban dwellers  (M = 40.8 , SD = 14.5) and this difference was statistically significant (t(58) = 3.22, p = 0.002). Conversely, the number of followers was greater for urban (Mean = 143.9, SD = 62.0) than for urban dwellers (M = 105.6, SD = 40.9) which was statistically significant (t(58) = 2.82, p = 0.007).
:::


Given these results have a go at writing up our conclusions. 

::: {style="border-left: 4px solid #8B5E3C; background-color: #F5F5DC; padding: 10px; margin: 10px 0;"}
<strong>Conclusions:</strong> Your conclusion will go here !
:::

## You are Free!

Well done ! This computing tutorial is now over. Make sure to thank your tutor for another amazing class full of wonderful statistics and learning !

```{r, echo=FALSE, out.width="50%", fig.align='center', fig.cap="Everyone loves statistics ?"}
knitr::include_graphics("https://github.com/BsoCool/UNSW-PSYC2001/blob/main/All%20images%20for%20computing%20tutorials/Testing_between_groups/Everyone%20loves%20statistics.jpg?raw=true")
```
